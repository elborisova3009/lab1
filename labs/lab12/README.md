## Лабораторная работа - Настройка NAT для IPv4
### Топология  
![image](https://user-images.githubusercontent.com/112883654/209936840-8c8b1754-e91d-4454-a9d3-2ca9c1585b3d.png)
### Таблица адресации
![image](https://user-images.githubusercontent.com/112883654/209937026-0fee4cd8-d4a2-4ec1-a95e-c464fbd33749.png)
### Цели
<details><summary>Часть 1. Создание сети и настройка основных параметров устройства.</summary>  

Шаг 1. В CPT создам сеть согласно топологии.  
 ![image](https://user-images.githubusercontent.com/112883654/209966373-a6773cce-b3ac-4a13-9e83-194b8f24c73b.png)  
Шаг 2. Произведу базовую настройку маршрутизаторов по стандартному алгоритму, после чего дам вывод команды `show run` для каждого маршрутизатора.   
a.	Назначу маршрутизатору имя устройства.  
b.	Отключу поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.  
c.	Назначу class в качестве зашифрованного пароля привилегированного режима EXEC.  
d.	Назначу cisco в качестве пароля консоли и включу вход в систему по паролю.  
e.	Назначу cisco в качестве пароля VTY и включу вход в систему по паролю.  
f.	Зашифрую открытые пароли.  
g.	Создам баннер с предупреждением о запрете несанкционированного доступа к устройству.  
h.	Настрою IP-адресацию интерфейсов по таблице адресации.    
i.	Настрою маршрут по умолчанию от R2 до  R1.  
j.	Сохраню текущую конфигурацию в файл загрузочной конфигурации.  
 R1:  
 ![image](https://user-images.githubusercontent.com/112883654/209963188-1defae40-cdd4-4207-bf15-d12ef35268f6.png)  
 ![image](https://user-images.githubusercontent.com/112883654/209963221-a63c6588-3dcd-4986-86d9-ad7add66f449.png)  
 ![image](https://user-images.githubusercontent.com/112883654/209963252-2fe0ce70-c4c6-400e-85d3-ae82c8c20c0a.png)  
 R2:  
 ![image](https://user-images.githubusercontent.com/112883654/209965825-cccdc84c-cf44-4f92-8489-e17bfd63f432.png)  
 ![image](https://user-images.githubusercontent.com/112883654/209965873-7126ed0c-95fa-4415-b982-53d97defd0e1.png)  
 ![image](https://user-images.githubusercontent.com/112883654/209965913-aa1d529a-f71e-4746-a5a8-ba034b125980.png)  
 
 Шаг 3. Настрою базовые параметры каждого коммутатора.  
a.	Присвою коммутатору имя устройства.  
b.	Отключу поиск DNS, чтобы предотвратить попытки маршрутизатора неверно преобразовывать введенные команды таким образом, как будто они являются именами узлов.  
c.	Назначу class в качестве зашифрованного пароля привилегированного режима EXEC.  
d.	Назначу cisco в качестве пароля консоли и включу вход в систему по паролю.  
e.	Назначу cisco в качестве пароля VTY и включу вход в систему по паролю.  
f.	Зашифрую открытые пароли.  
g.	Создам баннер с предупреждением о запрете несанкционированного доступа к устройству.  
h.	Выключу все интерфейсы, которые не будут использоваться.  
i.	Настрою IP-адресацию интерфейсов по таблице адресации.  
h.	Сохраню текущую конфигурацию в файл загрузочной конфигурации.  
 S1:  
 ![image](https://user-images.githubusercontent.com/112883654/209966913-18dcc8aa-b9cc-4a40-85ff-85cc72827853.png)  
 ![image](https://user-images.githubusercontent.com/112883654/212653846-aa46760d-69e6-4a4a-bb00-b538924c82fe.png)  
 S2:  
 ![image](https://user-images.githubusercontent.com/112883654/212655763-13dd714f-7dd4-457c-97c1-7459387b38e6.png)  
 ![image](https://user-images.githubusercontent.com/112883654/212655830-120020d7-c11e-46f7-9cac-ac103cc6b579.png)  
</details> 

<details><summary>Часть 2. Настройка и проверка NAT для IPv4.</summary>  
В данной части необходимо настроить и проверить NAT для IPv4.  

Шаг 1. Настрою NAT на R1, используя пул из трех адресов 209.165.200.226 - 209.165.200.228.  
a.	Настрою простой список доступа, который определит, какие хосты будут разрешены для трансляции. В этом случае все устройства в локальной сети R1 имеют право на трансляцию.  
b.	Создам пул NAT и укажу ему имя и диапазон используемых адресов.  
*Примечание. Параметр маски сети не является разделителем IP-адресов. Это должна быть правильная маска подсети для назначенных адресов, даже если я использую не все адреса подсети в пуле.*  
c.	Настрою перевод, связывая ACL и пул с процессом преобразования.  
*Примечание. Три очень важных момента:    
Во-первых, слово «inside» имеет решающее значение для работы такого рода NAT. Если опустить его, NAT не будет работать.  
Во-вторых, номер списка - это номер ACL, настроенный на предыдущем шаге.  
В-третьих, имя пула чувствительно к регистру.*  
d.	Задам внутренний (inside) интерфейс.  
e.	Задам внешний (outside) интерфейс.  
![image](https://user-images.githubusercontent.com/112883654/212657761-66dace49-b460-4268-a158-7ee897e48f9f.png)  
 Шаг 2. Проверю конфигурацию.  
 a.	С PC-B отправлю эхо-запрос на интерфейс Lo1 (209.165.200.1) на R2.   
 ![image](https://user-images.githubusercontent.com/112883654/212670242-6b8a8bf4-7ecc-424a-88cc-10f3abe385f1.png)  
 На R1 отображу таблицу NAT с помощью команды `show ip nat translations`:    
 ![image](https://user-images.githubusercontent.com/112883654/212683239-f8107cc6-9796-49e2-a7b0-2c4f8f5286e3.png)  
 Вопросы:
Во что был транслирован внутренний локальный адрес PC-B? *209.165.200.226*  
Какой тип адреса NAT является переведенным адресом? *Inside Global*  
 
b.	С PC-A отправлю эхо-запрос интерфейса Lo1 (209.165.200.1) на R2.  
 ![image](https://user-images.githubusercontent.com/112883654/212675755-09d28f6e-fc10-49b3-82bc-96daae7e2601.png)  
 На R1 отображу таблицу NAT с помощью команды `show ip nat translations`:    
![image](https://user-images.githubusercontent.com/112883654/212683419-f3ebb3de-7bae-400f-b521-09ea2c1b3cb2.png)   
 
c.	Обращу внимание, что предыдущая трансляция для PC-B все еще находится в таблице. 
Направлю c S1 эхо-запрос на интерфейс Lo1 (209.165.200.1) на R2.  
 ![image](https://user-images.githubusercontent.com/112883654/212677027-be0997dc-f05b-4bda-936f-740fc7eb4af6.png)  
 На R1 отображу таблицу NAT с помощью команды `show ip nat translations`:    
 ![image](https://user-images.githubusercontent.com/112883654/212683852-7f3bb502-907d-498a-bad4-1259a27651a0.png)  

 d.	Направлю c S2 эхо-запрос на интерфейс Lo1 (209.165.200.1) на R2.  
 На этот раз перевод завершается неудачей:  
 ![image](https://user-images.githubusercontent.com/112883654/212679540-3cb4d2d9-052f-4a66-9395-df2012401590.png)  
 
 e.	Это ожидаемый результат, потому что выделено только 3 адреса, а мы направили эхо-запрос с четырех устройств. Напомним, что NAT — это трансляция «один-в-один».  
 Как много выделено трансляций, можно узнать при выводе команды `show ip nat translations verbose`. Учитывая ограниченный функционал CPT, примем за данность, что ответ будет 24 часа.  
 ![image](https://user-images.githubusercontent.com/112883654/212680395-df689cd8-8c2e-4887-ba3f-e9d3fff818c9.png)  
 
 f.	Учитывая, что пул ограничен тремя адресами, NAT для пула адресов недостаточен для нашего приложения. Требуется очистить преобразование NAT и статистику прежде, чем мы перейдем к PAT.  
 Учитывая ограниченный функционал CPT:  
 ![image](https://user-images.githubusercontent.com/112883654/212680923-609489fa-ede0-409d-9430-efbf80b6ba9d.png)  
</details> 

<details><summary>Часть 3. Настройка и проверка PAT для IPv4.</summary>  
В данной части необходимо настроить замену NAT на PAT в пул адресов, а затем на PAT с помощью интерфейса.  
 
Шаг 1. Удалю команду преобразования на R1.  
Чтобы начать работу в части 3, удалю команду, связывающую ACL и пул вместе.  

Шаг 2. Добавлю команду PAT на R1.  
 Теперь настрою преобразование PAT в пул адресов (ACL и Pool уже настроены, так что это единственная команда, которую нужно изменить с NAT на PAT).  
 ![image](https://user-images.githubusercontent.com/112883654/212681940-d8b815e3-8b90-4cf1-8fb2-e2fb2cc5a2d3.png)  
 
Шаг 3. Проверка PAT.   
a. Проверю, что PAT работает.  
С PC-B запущу эхо-запрос интерфейса Lo1 (209.165.200.1) на R2.  
![image](https://user-images.githubusercontent.com/112883654/212682601-ef349e2b-5028-4cce-9af4-8506d503a3b0.png)  
 
На R1 отображу таблицу NAT на R1 с помощью команды `show ip nat translations`:  
 ![image](https://user-images.githubusercontent.com/112883654/212682729-4c7dbb89-fadd-411b-bf07-acce6c4f7a25.png)  
 Вопросы:  
 Во что был транслирован внутренний локальный адрес PC-B? *209.165.200.226*  
 Какой тип адреса NAT является переведенным адресом? *Inside Global*  
 Чем отличаются выходные данные команды `show ip nat translations` из упражнения NAT? *В данном случае разницы между внутренним и внешним адресом нет.*  
 
 b.	С PC-A запущу эхо-запрос интерфейса Lo1 (209.165.200.1) на R2.  
 ![image](https://user-images.githubusercontent.com/112883654/212685541-437b8edd-10fa-4980-8f8d-b09c8846ad2a.png)  
 На R1 отображу таблицу NAT на R1 с помощью команды `show ip nat translations`:  
 ![image](https://user-images.githubusercontent.com/112883654/212686579-0787d3f6-cff4-4856-a476-862b5738bb5c.png)  

 Обращу внимание, что при повторной отправке эхо-запроса и быстром возврате к маршрутизатору есть изменения:  
 ![image](https://user-images.githubusercontent.com/112883654/212686758-ffb166ae-1b70-4dbb-81da-c3069ad27667.png)  
 
 Учитывая ограниченный функционал CPT, примем за данность, что вывод команды `show ip nat translations verbose` должен показать смену времени ожидания перевода с 24 часов до 1 минуты.  
 ![image](https://user-images.githubusercontent.com/112883654/212687566-f0492cec-c316-4a89-9f7d-b271131e0345.png)  
 
 c.	Генерирую трафик с нескольких устройств для наблюдения PAT.    
 На PC-A и PC-B использую параметр -t с командой ping, чтобы отправить безостановочный ping на интерфейс Lo1 R2 (ping -t 209.165.200.1). 
 PC-A:  
![image](https://user-images.githubusercontent.com/112883654/212689277-c3d8846a-b307-483d-8e96-ec052843b134.png)  
 PC-B:  
![image](https://user-images.githubusercontent.com/112883654/212689326-91a85703-47a7-41c1-b38d-f787bd449c4c.png)  
 Вернусь на R1 и отображу таблицу NAT на R1 с помощью команды `show ip nat translations`:  
 ![image](https://user-images.githubusercontent.com/112883654/212689230-bb0d49a4-203c-420b-a94d-928b20b6a1e6.png)  
 Обращу внимание, что внутренний глобальный адрес одинаков для обоих сеансов.  
 
 Вопрос:  
 Как маршрутизатор отслеживает, куда идут ответы? *Присваиваются уникальные номера портов.*  
 
d.	PAT в пул является очень эффективным решением для малых и средних организаций. Тем не менее, есть неиспользуемые адреса IPv4, задействованные в этом сценарии.  
Мы перейдем к PAT с перегрузкой интерфейса, чтобы устранить эту трату IPv4 адресов. 
Остановлю ping на PC-A и PC-B с помощью комбинации клавиш Ctrl-C, затем нужно очистить трансляции и статистику.  
 Учитывая ограниченный функционал CPT:  
 ![image](https://user-images.githubusercontent.com/112883654/212691623-c9c769b4-db10-4c48-a49a-8c3b4e78284b.png)  
 
 Шаг 4. На R1 удалю команды преобразования nat pool.  
 Опять же, наш список доступа (список доступа 1) по-прежнему корректен для сетевого сценария, поэтому нет необходимости воссоздавать его.  
 Кроме того, внутренний и внешний интерфейсы не меняются.  
 Чтобы начать работу с PAT к интерфейсу, требуется очистить конфигурацию, удалив пул NAT и команду, связывающую ACL и пул вместе.  
 ![image](https://user-images.githubusercontent.com/112883654/212698990-ff2333da-0b9b-442c-bb40-0699b0caf71f.png)  
 
 Шаг 5. Добавлю команду PAT (указав внешний интерфейс), которая вызовет перегрузку этого интерфейса.  
 ![image](https://user-images.githubusercontent.com/112883654/212700906-43b02c77-29e8-49b8-8c75-65ec2b3d3672.png)  
 
 Шаг 6. Протестирую и проверю конфигурацию.  
 a.	С PC-B запущу эхо-запрос интерфейса Lo1 (209.165.200.1) на R2.  
 ![image](https://user-images.githubusercontent.com/112883654/212701712-b6658825-9baa-4a8b-9ad8-5006a4a399ce.png)  
 На R1 отображу таблицу NAT на R1 с помощью команды `show ip nat translations`:  
 ![image](https://user-images.githubusercontent.com/112883654/212702112-305bb701-b18b-4524-9fec-bbb4743ef8aa.png)  
 
 b.	Сделаю трафик с нескольких устройств для наблюдения PAT.  
 На PC-A и PC-B использую параметр -t с командой ping для отправки безостановочного ping на интерфейс Lo1 R2 (ping -t 209.165.200.1). 
 PC-A:  
 ![image](https://user-images.githubusercontent.com/112883654/212704211-201165d9-44af-4820-a3aa-b685e463412c.png)  
 PC-B:  
 ![image](https://user-images.githubusercontent.com/112883654/212704409-0f7122a4-8723-47a8-b199-229332537603.png)  
 
 На S1 и S2 выполню привилегированную команду `ping` на интерфейс Lo1 R2 (ping -t 209.165.200.1) с повтором 2000:  
 S1:  
 ![image](https://user-images.githubusercontent.com/112883654/212704950-00966cb2-b92b-49a5-a208-db75ef7dfbfa.png)  
 S2:  
 ![image](https://user-images.githubusercontent.com/112883654/212705114-57ef1d72-7df6-46a2-bf0f-60e3b10f8080.png)  
 Затем вернусь к R1 и отображу таблицу NAT на R1 с помощью команды `show ip nat translations`:  
 ![image](https://user-images.githubusercontent.com/112883654/212705394-31225e9a-d76c-4a4c-9ea9-84573585dfb0.png)  
 Теперь все внутренние глобальные адреса сопоставляются с IP-адресом интерфейса g0/0/0.  
 Остановлю все пинги на PC-A и PC-B.  
</details> 

<details><summary>Часть 4. Настройка и проверка статического NAT для IPv4.</summary>  
 В данной части будет настроена статическая NAT таким образом, чтобы PC-A был доступен напрямую из Интернета. PC-A будет доступен из R2 по адресу 209.165.200.229.  
 
*Примечание. Конфигурация ниже не соответствует рекомендуемым практикам для шлюзов, подключенных к Интернету. В лабораторной работе отсутствуют стандартные методы безопасности, чтобы сосредоточиться на успешной конфигурации статического NAT. В производственной среде решающее значение для удовлетворения этого требования будет иметь тщательная координация между сетевой инфраструктурой и группами безопасности.*  
 
 Шаг 1. На R1 очищу текущие трансляции и статистику.  
 Учитывая ограниченный функционал CPT:  
![image](https://user-images.githubusercontent.com/112883654/212691623-c9c769b4-db10-4c48-a49a-8c3b4e78284b.png)  
 
 Шаг 2. На R1 настрою команду NAT, необходимую для статического сопоставления внутреннего адреса с внешним адресом.  
Для этого шага настрою статическое сопоставление между 192.168.1.11 и 209.165.200.1 с помощью следующей команды:  
![image](https://user-images.githubusercontent.com/112883654/212887417-cddd66bd-80fa-4076-9dd6-1db9734aff50.png)  
 
 Шаг 3. Протестирую и проверю конфигурацию.  
a.	Проверю, работает ли статический NAT. Чтобы увидеть статическое сопоставление, отображу таблицу NAT на R1 с помощью команды `show ip nat translations`:  
 ![image](https://user-images.githubusercontent.com/112883654/212889316-047c9599-2d6a-4ed6-b135-af4141e7cb74.png)  
 
b.	Таблица перевода показывает, что статическое преобразование действует. Проверю это, запустив ping с R2 на 209.165.200.229:  
 ![image](https://user-images.githubusercontent.com/112883654/212892266-5b5cd193-c249-4d52-af56-b79990acdb9a.png)  
 
c.	На R1 отображу таблицу NAT на R1 с помощью команды `show ip nat translations`, чтобы увидеть статическое сопоставление и преобразование на уровне порта для входящих pings: 
 ![image](https://user-images.githubusercontent.com/112883654/212892713-17de23d3-88b0-4b41-a1a7-ded483ebdb29.png)  
 Это подтверждает, что статический NAT работает.  
</details> 
